# IdeaForge -- Guardian Analysis

**Generated by**: apex-guardian
**Source ADR**: docs/architecture/adr.md (v1.0, 2026-02-12)
**Source PRD**: docs/product/prd.md (v1.0, 2026-02-12)
**Source Constraints**: docs/strategy/constraint-analysis.md
**Date**: 2026-02-12
**Verdict**: PROCEED WITH CAUTION

---

## Analysis Summary

| Category                     | Count |
|------------------------------|-------|
| BLOCKING findings            | 3     |
| WARNING findings             | 12    |
| NOTE findings                | 10    |
| Total findings               | 25    |

---

## BLOCKING Findings

### BLOCK-01: FTS5 content_rowid Uses SQLite Internal rowid on TEXT Primary Key Table

**Severity**: BLOCKING
**Location**: adr.md lines 383-407

The FTS5 virtual table is configured with `content_rowid=rowid`:

```sql
CREATE VIRTUAL TABLE ideas_fts USING fts5(
  title, content,
  content=ideas,
  content_rowid=rowid,
  tokenize='porter unicode61'
);
```

The `ideas` table uses `id TEXT PRIMARY KEY`, which means SQLite assigns an internal integer rowid automatically. However, this internal rowid is NOT guaranteed to remain stable across database exports and re-imports (the exact persistence mechanism IdeaForge uses via `db.export()` into IndexedDB). If the binary blob is re-loaded, SQLite may reassign internal rowids, causing the FTS5 index to point to wrong rows.

The FTS5 sync triggers (lines 392-407) reference `new.rowid` and `old.rowid`, which will work for in-session operations, but the FTS5 index can desync after a database reload if rowids shift.

**Impact**: Search results could return wrong ideas or crash after database reload from IndexedDB.

**Recommendation**: Either (a) add an explicit INTEGER `rowid_alias` column to `ideas` and populate it with a stable auto-incrementing integer, then use that for `content_rowid`, or (b) rebuild the FTS5 index on every database load with `INSERT INTO ideas_fts(ideas_fts) VALUES('rebuild')`. Option (b) is simpler but adds startup latency; option (a) is more robust.

**Resolution required before**: Task decomposition for database layer.

---

### BLOCK-02: PRD and ADR Schema Mismatch on ai_interactions Table

**Severity**: BLOCKING
**Location**: adr.md lines 360-370 vs prd.md lines 804-814

The ADR defines `ai_interactions` with two token columns:

```sql
-- ADR (adr.md:360-370)
input_tokens INTEGER,
output_tokens INTEGER,
cost_estimate REAL,
```

The PRD defines the same table with one token column:

```sql
-- PRD (prd.md:804-814)
tokens_used INTEGER,
cost_estimate REAL,
```

Additionally, the PRD schema (prd.md:817-820) omits `created_at` from the `tags` table, while the ADR (adr.md:333-337) includes it. The PRD schema also omits `ON DELETE CASCADE` on all foreign keys, while the ADR includes them.

**Impact**: Developers referencing the PRD for context will use the wrong column names. The cost-tracker service (adr.md:928-947) expects `inputTokens` and `outputTokens` as separate values, confirming the ADR schema is the intended one, but the PRD creates ambiguity.

**Recommendation**: Update the PRD schema to match the ADR schema exactly, or add a prominent note in the PRD stating "See ADR Section 3.1 for the authoritative schema." Mark the PRD schema as deprecated.

**Resolution required before**: Any developer reads the PRD for database context.

---

### BLOCK-03: Zod CreateIdeaSchema Uses "description" but SQLite Column Is "content"

**Severity**: BLOCKING
**Location**: adr.md lines 1688-1707 vs adr.md lines 321-330

The Zod validation schema `CreateIdeaSchema` (adr.md:1688-1707) defines:

```typescript
export const CreateIdeaSchema = z.object({
  title: z.string().min(1, 'Title is required').max(200, 'Title too long').trim(),
  description: z.string().optional().default(''),   // <-- "description"
  tags: z.array(...).optional().default([]),
});
```

But the SQLite `ideas` table (adr.md:321-330) uses `content`:

```sql
CREATE TABLE ideas (
  id TEXT PRIMARY KEY,
  title TEXT NOT NULL,
  content TEXT DEFAULT '',   -- <-- "content"
  ...
);
```

The `UpdateIdeaSchema` (adr.md:1709-1727) correctly uses `content`. This inconsistency means the repository layer must map `description` to `content` on insert, but `content` to `content` on update, creating a naming asymmetry that will cause bugs.

**Impact**: Without explicit field mapping, INSERT operations will either fail (column "description" does not exist) or silently drop the field, resulting in empty idea content on creation.

**Recommendation**: Rename `description` to `content` in `CreateIdeaSchema` for consistency with the database column and `UpdateIdeaSchema`. If the UI label should say "Description" for the spark capture form, handle that at the component level, not in the Zod schema field name.

**Resolution required before**: Task decomposition for spark capture feature.

---

## WARNING Findings

### WARN-01: persist() Method Is Fire-and-Forget

**Severity**: WARNING
**Location**: adr.md lines 1123-1141

The `persist()` method in DatabaseManager wraps the actual persistence inside `setTimeout` with a 2-second debounce, but the outer function returns `Promise<void>` immediately. The `setTimeout` callback is `async` but its result is never awaited or caught at the call site:

```typescript
async function persist(): Promise<void> {
  if (persistTimer) clearTimeout(persistTimer);
  persistTimer = setTimeout(async () => {   // fire-and-forget
    try {
      const data = db.export();
      await saveToIndexedDB(DB_KEY, data);
    } catch (error) {
      throw new DatabaseError('Failed to persist database', { ... });
    }
  }, PERSIST_DEBOUNCE_MS);
}
```

The `throw` inside the setTimeout callback will become an unhandled promise rejection because nothing awaits the setTimeout callback. The error will NOT propagate to the caller of `persist()`.

**Impact**: Database persistence failures will be silently swallowed. Users will see no error when their data fails to save.

**Recommendation**: Store a reference to the pending persist promise and expose it. Alternatively, use a proper debounce utility that returns the debounced promise:

```typescript
let pendingPersist: Promise<void> | null = null;
async function persist(): Promise<void> {
  if (persistTimer) clearTimeout(persistTimer);
  return new Promise((resolve, reject) => {
    persistTimer = setTimeout(async () => {
      try {
        const data = db.export();
        await saveToIndexedDB(DB_KEY, data);
        resolve();
      } catch (error) {
        reject(new DatabaseError('Failed to persist', { ... }));
      }
    }, PERSIST_DEBOUNCE_MS);
  });
}
```

---

### WARN-02: WAL Mode Is Not Supported by sql.js

**Severity**: WARNING
**Location**: adr.md line 1103

```typescript
db.run('PRAGMA journal_mode=WAL');
```

sql.js operates as an in-memory database with manual persistence. WAL (Write-Ahead Logging) is a disk-based journaling mode that has no effect in sql.js because there is no filesystem. This PRAGMA will either silently fail or be ignored.

**Impact**: No functional impact (the PRAGMA is a no-op), but it indicates a misunderstanding of the sql.js execution model that could lead to incorrect assumptions about concurrent access or crash recovery.

**Recommendation**: Remove the WAL PRAGMA. Add a comment explaining that sql.js is in-memory and persistence is handled manually via `db.export()` to IndexedDB.

---

### WARN-03: FTS5 Tokenizer Needs Verification with sql.js WASM Build

**Severity**: WARNING
**Location**: adr.md line 388

```sql
tokenize='porter unicode61'
```

Not all sql.js builds include the FTS5 extension with the porter stemmer tokenizer. The standard npm package `sql.js@^1.11.0` does include FTS5, but the porter tokenizer availability depends on the compile-time flags used. If the tokenizer is not available, the `CREATE VIRTUAL TABLE` statement will fail at runtime.

**Impact**: Application will crash on startup if the tokenizer is unavailable.

**Recommendation**: Include this in the Week 1 spike validation. Test the exact `CREATE VIRTUAL TABLE` statement with the exact sql.js version. Have a fallback using the default tokenizer (`tokenize='unicode61'` without porter stemming).

---

### WARN-04: Streaming + withRetry() May Cause Duplicate Partial Responses

**Severity**: WARNING
**Location**: adr.md lines 997-1061

The AI service wraps the `streamText` call with `withRetry()`:

```typescript
const result = await withRetry(
  () => streamText({ ... }),
  { maxRetries: 2 }
);
```

If the stream starts successfully (HTTP 200) but fails mid-stream (network drop), the retry logic will restart the entire request. The UI may have already rendered partial tokens from the first attempt. Without clearing the UI state between retries, the user will see the first partial response followed by a complete second response, creating duplicate/garbled text.

**Impact**: AI chat could display garbled responses after network interruptions.

**Recommendation**: Either (a) do not retry streaming requests (only retry the initial connection), or (b) ensure the UI clears displayed tokens before each retry attempt. This needs to be specified in the AI chat task.

---

### WARN-05: XOR Encryption for API Keys Is Security Theater

**Severity**: WARNING
**Location**: adr.md line 1259

> "API keys are stored in localStorage [encrypted with a simple XOR using a device-derived key via Web Crypto API]"

XOR with a device-derived key stored in the same browser provides no meaningful protection. Any JavaScript running on the page (including browser extensions or XSS) can access both the encrypted value and the key. This is equivalent to base64 encoding -- it obscures but does not protect.

**Impact**: Creates a false sense of security. Users may believe their API keys are protected when they are not.

**Recommendation**: Either (a) acknowledge in the UI that API keys are stored in plaintext in the browser (honesty is better than false security), or (b) use the Web Crypto API with a user-provided passphrase for actual encryption (adds UX friction). For MVP, option (a) with a clear warning is appropriate.

---

### WARN-06: Design System Uses Next.js Import Instead of React Router

**Severity**: WARNING
**Location**: design-system.md line 1449

```typescript
import Link from "next/link"
```

The design system app-shell component imports `Link` from `next/link`, but the ADR specifies React Router 7.x (adr.md lines 640-675). This is a direct conflict -- the design system code will not compile in a Vite + React Router project.

**Impact**: Copy-pasting the app-shell component from the design system will cause import errors.

**Recommendation**: Update the design system to use `import { Link } from 'react-router'` and `<Link to="/path">` instead of `<Link href="/path">`. Note that React Router uses `to` prop, not `href`.

---

### WARN-07: Tailwind v4 CSS-First Config Conflicts with v3 JS Config

**Severity**: WARNING
**Location**: design-system.md (multiple sections)

The design system contains both Tailwind v3-style `tailwind.config.js` configuration AND Tailwind v4 `@theme` CSS-first configuration. The ADR specifies Tailwind 4.x (adr.md line 89-100), which uses the CSS-first approach exclusively. The JS config is not used in Tailwind v4.

**Impact**: Developers may use the wrong configuration format, causing theme tokens to not apply correctly.

**Recommendation**: Remove all `tailwind.config.js` references from the design system. Keep only the `@theme` CSS-first configuration blocks.

---

### WARN-08: Missing Zustand Store Type Definitions

**Severity**: WARNING
**Location**: adr.md lines 596-601

The ADR directory structure lists three Zustand slices:

```
store/
  index.ts
  slices/
    idea-slice.ts
    ai-slice.ts
    ui-slice.ts
```

But no type definitions or interfaces are provided for the store shape. The ADR provides types for services (IAIServiceDeps, IDatabaseManager, ISearchResult) but not for the Zustand store. Without explicit store types, developers will make incompatible assumptions about state shape.

**Impact**: Store slice implementations may have incompatible types that only surface during integration.

**Recommendation**: Define `IIdeaSlice`, `IAISlice`, `IUISlice`, and `IAppStore` interfaces in the ADR or create a separate types document. At minimum, document the key state fields and actions for each slice.

---

### WARN-09: Missing Domain Entity Types

**Severity**: WARNING
**Location**: adr.md lines 620-623

The ADR references type files:

```
types/
  idea.ts    -- IIdea, IdeaStatus, etc.
  ai.ts      -- IAIMessage, IAIConfig, etc.
  common.ts  -- Shared types
```

These types are used throughout the ADR code samples (e.g., `IIdea` in context-builder.ts at line 861, `IAIMessage` at line 862, `IAIConfig` at line 963) but their definitions are never provided.

**Impact**: Every developer task that touches these types will need to reverse-engineer the shape from usage sites. Different developers may infer different shapes.

**Recommendation**: Define `IIdea`, `IdeaStatus`, `IAIMessage`, `IAIConfig`, `IConnection`, and `ITag` interfaces explicitly. These are the most-referenced types in the entire ADR.

---

### WARN-10: Math.random() Used for Toast IDs in Design System

**Severity**: WARNING
**Location**: design-system.md line 1212

```typescript
const id = Math.random().toString(36)
```

The design system toast hook uses `Math.random()` for generating toast IDs. While toast IDs are not security-sensitive, the global coding standards (CLAUDE.md) explicitly prohibit `Math.random()` for any ID generation, requiring `crypto.randomUUID()` instead.

**Impact**: Violates coding standards. Could theoretically produce duplicate IDs if many toasts fire rapidly (though practically unlikely).

**Recommendation**: Replace with `crypto.randomUUID()` per project standards:

```typescript
const id = crypto.randomUUID()
```

---

### WARN-11: Missing MVP Components in Design System

**Severity**: WARNING
**Location**: design-system.md (Future Components section)

The design system lists Dropdown Menu, Tooltip, and Skeleton as "Future Components" to be built later. However, the ADR directory structure (adr.md:494-496) includes these as part of the MVP UI components:

```
components/ui/
  dropdown-menu.tsx
  tooltip.tsx
  skeleton.tsx
```

And the ADR dependencies (adr.md:1779-1781) include Radix packages for these:

```
@radix-ui/react-dropdown-menu ^2.1.0
@radix-ui/react-tooltip ^1.1.0
```

**Impact**: Developers building features that need these components will find no design system specifications for them.

**Recommendation**: Either promote these components from "Future" to "MVP" in the design system, or add a note in the ADR that these components should be built during their respective feature tasks without pre-existing design system specs.

---

### WARN-12: Flash of Unstyled Content (FOUC) Risk with WASM Loading

**Severity**: WARNING
**Location**: adr.md lines 481, 1089-1094

The entry point (`main.tsx`) initializes the database asynchronously:

```typescript
const SQL = await initSqlJs({
  locateFile: (file: string) => '/sql.js/' + file,
});
```

sql.js WASM loading can take 200-500ms. During this time, the React app either (a) renders without database access (causing empty states) or (b) blocks rendering entirely (causing a blank screen). The ADR mentions a `LoadingSkeleton` in the Suspense fallback (adr.md:671) but does not detail how database initialization integrates with the React render lifecycle.

**Impact**: Users may see empty dashboards or loading spinners on every page load.

**Recommendation**: Explicitly design the initialization flow: (1) Show skeleton UI immediately, (2) Initialize sql.js in parallel, (3) Load database from IndexedDB, (4) Hydrate Zustand store, (5) Render with data. Define this sequence in the task for the foundation layer.

---

## NOTE Findings

### NOTE-01: Bundle Size Budget May Be Tight

**Severity**: NOTE
**Location**: adr.md lines 1319-1330

The total JS budget is <230KB gzipped, but the dependency list is substantial: React 19, React Router 7, Zustand 5, TipTap (5 packages), Vercel AI SDK (3 packages), Radix UI (6 packages), Zod, CVA, clsx, tailwind-merge, lucide-react, lowlight, date-fns. The vendor-editor chunk alone (TipTap + extensions) is budgeted at 80KB which may be tight with code-block-lowlight including syntax highlighting grammars.

**Impact**: May exceed bundle size budget, requiring tree-shaking optimization or feature cuts.

**Recommendation**: Measure actual bundle sizes in Week 1 spike. Consider lazy-loading the code-block-lowlight extension.

---

### NOTE-02: CSP Uses unsafe-inline for Styles

**Severity**: NOTE
**Location**: adr.md line 1270

```
style-src 'self' 'unsafe-inline';
```

The CSP allows `unsafe-inline` for styles, which is required for TipTap editor styling and Tailwind utilities that may inject inline styles. This is a known trade-off for this tech stack.

**Impact**: Slightly weakened CSP, but acceptable given the client-only architecture.

**Recommendation**: Document this as an intentional trade-off. No action needed for MVP.

---

### NOTE-03: Backup Format Not Explicitly Defined

**Severity**: NOTE
**Location**: adr.md lines 1143-1149

The backup function stores `db.export()` (a `Uint8Array` binary blob) with a timestamp key. However, the ADR does not specify whether backups should be restorable individually, whether the user can trigger manual backups, or what happens when the user clicks "restore."

**Impact**: Feature implementation will need to make UX decisions not covered by the ADR.

**Recommendation**: Add acceptance criteria for backup/restore UX to the relevant user story.

---

### NOTE-04: @tanstack/react-virtual Listed as Dev Dependency

**Severity**: NOTE
**Location**: adr.md line 1806

`@tanstack/react-virtual` is listed under Development Dependencies (Section 11.2) but it is a runtime dependency used for virtual scrolling in the ideas list (referenced at adr.md:1350). It should be in Production Dependencies (Section 11.1).

**Impact**: May cause build/deployment issues if dev dependencies are excluded from production builds.

**Recommendation**: Move `@tanstack/react-virtual ^3.11.0` to Section 11.1 Production Dependencies.

---

### NOTE-05: CORS Preflight for Anthropic Direct Browser Access

**Severity**: NOTE
**Location**: adr.md lines 980-985

The direct browser-to-Anthropic calls use the `anthropic-dangerous-direct-browser-access` header. This is a non-standard header that requires Anthropic to include it in their CORS preflight response. If Anthropic changes their CORS policy, all AI functionality breaks.

**Impact**: External dependency on Anthropic CORS configuration. Already identified as a risk in the ADR (line 1958) with a Cloudflare Worker fallback.

**Recommendation**: Ensure the Cloudflare Worker fallback is documented as a concrete task, not just a contingency. Include it in the Week 1 spike.

---

### NOTE-06: Hardcoded Model Pricing Will Become Stale

**Severity**: NOTE
**Location**: adr.md lines 913-926

```typescript
const MODEL_PRICING: Record<string, IModelPricing> = {
  'claude-sonnet-4-20250514': { inputPricePerMillion: 3.0, outputPricePerMillion: 15.0 },
  'claude-haiku-3.5': { inputPricePerMillion: 0.25, outputPricePerMillion: 1.25 },
  'gpt-4o-mini': { inputPricePerMillion: 0.15, outputPricePerMillion: 0.6 },
};
```

These prices are hardcoded and will become outdated as AI providers change pricing. The `calculateCost` function returns 0 for unknown models, silently hiding costs.

**Impact**: Cost estimates will drift from reality over time.

**Recommendation**: Add a "last verified" date comment to the pricing table. Consider fetching pricing from a config file or settings rather than hardcoding. Log a warning for unknown models instead of returning 0.

---

### NOTE-07: Connection Uniqueness Not Enforced

**Severity**: NOTE
**Location**: adr.md lines 347-357

The `connections` table has no unique constraint on `(source_id, target_id, type)`. A user (or AI) could create duplicate connections between the same two ideas with the same type.

**Impact**: Duplicate connections could clutter the UI. Low severity for MVP since connections are Phase 1.5.

**Recommendation**: Add `UNIQUE(source_id, target_id, type)` constraint to the connections table schema.

---

### NOTE-08: FTS5 Sanitizer Strips Quotes, Preventing Phrase Search

**Severity**: NOTE
**Location**: adr.md lines 1240-1247

```typescript
function sanitizeFTSQuery(query: string): string {
  return query
    .replace(/['"*()]/g, '')
    .split(/\s+/)
    .filter(term => term.length >= 2)
    .map(term => '"' + term + '"' + '*')
    .join(' ');
}
```

The sanitizer strips all quote characters before wrapping each term in quotes for prefix matching. This means users cannot perform phrase searches (e.g., `"machine learning"` as a phrase). Each word is searched independently.

**Impact**: Search is less precise than users may expect. Acceptable for MVP.

**Recommendation**: Document this limitation. Consider adding phrase search support in a future iteration.

---

### NOTE-09: date-fns May Be Replaceable with Intl API

**Severity**: NOTE
**Location**: adr.md line 1790

`date-fns ^4.1.0` is included for date formatting. Modern browsers have `Intl.RelativeTimeFormat` and `Intl.DateTimeFormat` which can handle most formatting needs. Since IdeaForge targets modern browsers only, date-fns may be unnecessary bundle weight.

**Impact**: Adds ~5-10KB gzipped to the bundle.

**Recommendation**: Evaluate whether `Intl` APIs cover the formatting needs before adding date-fns. If only relative time ("2 hours ago") and basic formatting are needed, native APIs suffice.

---

### NOTE-10: Metadata Column Parsing Not Specified

**Severity**: NOTE
**Location**: adr.md line 329

```sql
metadata TEXT DEFAULT '{}'
```

The `metadata` column stores a JSON string, but the ADR does not specify how it is parsed or validated. The `IIdea` type is not defined, so it is unclear whether `metadata` is typed as `Record<string, unknown>`, a specific interface, or `string`.

**Impact**: Inconsistent metadata handling across features.

**Recommendation**: Define the metadata schema (even if it starts as `Record<string, unknown>`) and ensure it is validated with Zod on read from the database.

---

## Technology Compatibility Assessment

| Integration | Status | Notes |
|-------------|--------|-------|
| sql.js + FTS5 | NEEDS VALIDATION | FTS5 included in standard build; porter tokenizer needs verification (WARN-03) |
| sql.js + IndexedDB persistence | NEEDS VALIDATION | db.export() produces Uint8Array; storage/reload needs Week 1 spike (BLOCK-01) |
| TipTap + Markdown storage | NEEDS VALIDATION | tiptap-markdown handles roundtrip; fidelity needs Week 1 spike |
| Vercel AI SDK + Anthropic (browser) | NEEDS VALIDATION | anthropic-dangerous-direct-browser-access header required; CORS needs spike (NOTE-05) |
| Vercel AI SDK + streaming | COMPATIBLE | Well-documented pattern; retry interaction needs care (WARN-04) |
| React 19 + React Router 7 | COMPATIBLE | Standard combination |
| Tailwind 4 + CVA | COMPATIBLE | CSS-first @theme config; remove JS config references (WARN-07) |
| Zustand 5 + React 19 | COMPATIBLE | Standard combination |
| Radix UI + Tailwind | COMPATIBLE | Unstyled primitives work with any CSS approach |
| Vite 6 + sql.js WASM | COMPATIBLE | Vite has native WASM support; needs `vite-plugin-wasm` or `wasm-unsafe-eval` CSP |

---

## Security Review Summary

| Area | Status | Finding |
|------|--------|--------|
| API Key Storage | WEAK | XOR encryption is security theater (WARN-05). Recommend honest plaintext disclosure. |
| XSS Prevention | ADEQUATE | TipTap sanitization + React JSX escaping + parameterized SQL. |
| CSP | ADEQUATE | wasm-unsafe-eval needed for sql.js; unsafe-inline for styles is acceptable trade-off (NOTE-02). |
| Input Validation | GOOD | Zod schemas for all inputs; parameterized SQL; tag regex validation. |
| Data Safety | GOOD | All data local; auto-backup; export from day 1; no telemetry. |
| SQL Injection | GOOD | All queries use parameterized statements per ADR Section 6.5. |

---

## Risk Matrix

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| FTS5 rowid desync after reload | HIGH | HIGH | BLOCK-01: Add rebuild or stable rowid |
| Schema confusion from PRD/ADR mismatch | MEDIUM | HIGH | BLOCK-02: Designate ADR as authoritative |
| Zod/DB field name mismatch | HIGH | MEDIUM | BLOCK-03: Rename description to content |
| Silent data loss from persist() | MEDIUM | HIGH | WARN-01: Fix promise propagation |
| Streaming retry garbled text | LOW | MEDIUM | WARN-04: Clear UI between retries |
| Bundle size exceeds budget | MEDIUM | LOW | NOTE-01: Measure in Week 1 spike |

---

## Decomposer Guidance

### For ALL Tasks

```
CRITICAL: The ADR (docs/architecture/adr.md) is the AUTHORITATIVE source for
all schemas, types, and interfaces. Do NOT reference the PRD schema
(prd.md Section 4.3) -- it is outdated and conflicts with the ADR.
```

### For Database Layer Tasks

```
BLOCKING CONSTRAINT: FTS5 content_rowid uses SQLite internal rowid, which may
desync on database reload. MUST either:
  (a) Add FTS5 rebuild on database load: INSERT INTO ideas_fts(ideas_fts) VALUES('rebuild')
  (b) Add explicit integer rowid alias column to ideas table

BLOCKING CONSTRAINT: The persist() method is fire-and-forget. MUST be rewritten
to properly propagate errors to callers.

WARNING: Remove PRAGMA journal_mode=WAL -- it has no effect in sql.js.

WARNING: Verify FTS5 porter tokenizer availability in sql.js ^1.11.0 before
using tokenize='porter unicode61'. Have fallback tokenizer ready.
```

### For Spark Capture Tasks

```
BLOCKING CONSTRAINT: The Zod CreateIdeaSchema uses "description" but the SQLite
column is "content". MUST rename the Zod field to "content" before implementing.

The CreateIdeaSchema is at: src/lib/validation.ts
The ideas table schema is at: adr.md Section 3.1 lines 321-330
```

### For AI Chat Tasks

```
WARNING: withRetry() wrapping streamText() may cause duplicate partial responses
if the stream fails mid-response. Either:
  (a) Do not retry streaming requests (only retry connection failures)
  (b) Clear the UI message buffer between retry attempts

WARNING: Cost tracker has hardcoded pricing (adr.md:913-926). Return 0 for
unknown models but LOG A WARNING, do not silently return 0.

The AI service pattern is: createAIService(deps) returning { chat } function.
Uses dependency injection via IAIServiceDeps interface.
```

### For UI Component Tasks

```
WARNING: Design system app-shell uses 'next/link' import. MUST use
'react-router' Link with 'to' prop instead of 'href'.

WARNING: Design system toast hook uses Math.random(). MUST use crypto.randomUUID().

WARNING: Dropdown Menu, Tooltip, and Skeleton are listed as "Future Components"
in the design system but are needed for MVP. Build these during their respective
feature tasks using Radix UI primitives.

WARNING: Use only Tailwind v4 @theme CSS-first configuration. Ignore any
tailwind.config.js references in the design system.
```

### For Store/State Tasks

```
WARNING: No Zustand store type definitions exist in the ADR. Define IIdeaSlice,
IAISlice, IUISlice, and IAppStore interfaces before implementing slices.

WARNING: Domain entity types (IIdea, IdeaStatus, IAIMessage, IAIConfig, etc.)
are referenced throughout the ADR but never defined. These MUST be defined first
as they are dependencies for all features.
```

---

## Verdict

**PROCEED WITH CAUTION**

The ADR is comprehensive and well-structured. The three BLOCKING findings are all resolvable
without architectural changes -- they are naming/configuration issues, not design flaws. The
WARNING findings identify real integration risks that must be addressed in task specifications.

**Before task decomposition begins, resolve:**
1. BLOCK-01: Decide FTS5 rowid strategy (rebuild on load vs stable alias)
2. BLOCK-02: Mark PRD schema as superseded by ADR
3. BLOCK-03: Rename CreateIdeaSchema.description to .content

**Decomposer must include** the guidance sections above in every relevant task specification
to prevent integration failures.

---

*Analysis performed against: adr.md v1.0, prd.md v1.0, constraint-analysis.md, design-system.md, feature-breakdown.md*
